<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Portal Variant Test</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        line-height: 1.6;
      }
      h1,
      h2 {
        color: #333;
      }
      button {
        padding: 10px 15px;
        margin: 5px;
        background-color: #007bff;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }
      button:hover {
        background-color: #0056b3;
      }
      .test-section {
        margin-bottom: 20px;
        padding: 15px;
        border: 1px solid #ccc;
        border-radius: 5px;
        background-color: #f9f9f9;
      }
      pre {
        background-color: #e9e9e9;
        padding: 10px;
        border-radius: 4px;
        overflow-x: auto;
        white-space: pre-wrap;
        word-break: break-all;
      }
      .result {
        font-weight: bold;
      }
    </style>
  </head>
  <body>
    <h1>Portal Variant Test Harness</h1>

    <div class="test-section">
      <h2>Variant Index Control</h2>
      <button id="decrement-variant">Decrement Variant Index</button>
      <button id="increment-variant">Increment Variant Index</button>
      <button id="reset-variant">Reset Variant Index (0)</button>
      <p>
        Current <code>state.variantIndex</code>:
        <span id="current-variant-index" class="result">0</span>
      </p>
    </div>

    <div class="test-section">
      <h2>Background Mapping</h2>
      <p>
        Background for current variant:
        <span id="current-background" class="result"></span>
      </p>
      <pre id="sequence-display"></pre>
    </div>

    <script type="module">
      import { state } from './src/state.js';
      import {
        BACKGROUND_SEQUENCE,
        backgroundForVariant,
      } from './src/backgrounds.js';

      let currentVariantIndex = state.variantIndex;

      function updateDisplay() {
        document.getElementById('current-variant-index').textContent =
          currentVariantIndex;
        const bgKey = backgroundForVariant(currentVariantIndex);
        document.getElementById('current-background').textContent = bgKey;

        let sequenceOutput = 'BACKGROUND_SEQUENCE:\n';
        BACKGROUND_SEQUENCE.forEach((bg, index) => {
          const effectiveIndex = index + 1; // variantIndex 1 maps to BACKGROUND_SEQUENCE[0]
          const mappedBgKey = backgroundForVariant(effectiveIndex);
          const highlight =
            currentVariantIndex === effectiveIndex ? '  <-- CURRENT' : '';
          sequenceOutput += `  Variant Index ${effectiveIndex}: ${bg} (mapped: ${mappedBgKey})${highlight}\n`;
        });
        sequenceOutput += `\nVariant Index 0 or less maps to 'sky'. Current mapped: ${backgroundForVariant(0)}`;
        document.getElementById('sequence-display').textContent =
          sequenceOutput;
      }

      document
        .getElementById('decrement-variant')
        .addEventListener('click', () => {
          currentVariantIndex = Math.max(0, currentVariantIndex - 1);
          updateDisplay();
        });

      document
        .getElementById('increment-variant')
        .addEventListener('click', () => {
          currentVariantIndex++;
          updateDisplay();
        });

      document.getElementById('reset-variant').addEventListener('click', () => {
        currentVariantIndex = 0;
        updateDisplay();
      });

      // Initial display
      updateDisplay();
    </script>
  </body>
</html>
